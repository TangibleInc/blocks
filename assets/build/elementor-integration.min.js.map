{"version":3,"file":"elementor-integration.min.js","sources":["../src/template-controls-visibility/index.js","../src/elementor-integration/widgets/visibility/repeater.js","../src/elementor-integration/widgets/tabs.js","../src/elementor-integration/widgets/visibility/general.js","../src/elementor-integration/widgets/index.js","../src/common/modal/Modal.jsx","../src/template-block-fields/index.jsx","../src/template-block-fields/Control.jsx","../src/template-block-fields/legacy-fields/Text.jsx","../src/common/Select.jsx","../src/template-block-fields/legacy-fields/post-query/Order.jsx","../src/template-block-fields/legacy-fields/post-query/Type.jsx","../src/template-block-fields/legacy-fields/taxonomy/query-group.jsx","../src/template-block-fields/legacy-fields/taxonomy/index.jsx","../src/template-block-fields/legacy-fields/post-query/PostQuery.jsx","../src/template-block-fields/legacy-fields/ajax-select/index.jsx","../src/template-block-fields/legacy-fields/index.jsx","../src/template-block-fields/legacy-fields/LegacyControl.jsx","../src/elementor-integration/fields/legacy.jsx","../src/elementor-integration/fields/index.jsx"],"sourcesContent":["/**\r\n * Evaluate current conditions to determine block control visibility\r\n *\r\n * @see gutenberg-template-editor/blocks/dynamic/create.js\r\n * @see beaver-template-editor/modules/dynamic/module.js\r\n * @see elementor-template-editor/widgets/dynamic/visibility.js\r\n */\r\n\r\nexport default class ControlVisibility {\r\n\r\n  constructor(conditionsMap) {\r\n\r\n    this.conditionsMap = conditionsMap || []\r\n\r\n    this.getPreviousLevels = this.getPreviousLevels.bind(this)\r\n    this.getCondition = this.getCondition.bind(this)\r\n  }\r\n\r\n  evaluateConditions(conditions, getFieldValue) {\r\n\r\n    let visibility = true\r\n\r\n    if( ! conditions || ! Array.isArray(conditions) ) return visibility\r\n\r\n    for (const key of conditions) {\r\n      const condition = this.getCondition(key)\r\n      if ( ! this.evaluateCondition(condition, getFieldValue) ) return false\r\n    }\r\n\r\n    return visibility\r\n  }\r\n\r\n  /**\r\n   * Complete conditions are not stored in items, but it has a key to get it\r\n   *\r\n   * Key structure is: 0-0\r\n   *\r\n   * First is the condition number, refering to an ensemble like:\r\n   * <If>  .... <Else if> .... <If>\r\n   *\r\n   * Second is the condition level, refering to which level of the\r\n   * ensemble needs to be applied (only the starting <If> is 0 for example)\r\n   */\r\n  getCondition(key) {\r\n\r\n    const indexes = key.split('-')\r\n\r\n    const number = parseInt(indexes[0])\r\n    const level  = parseInt(indexes[1])\r\n    \r\n    const data = {\r\n      number: number,\r\n      level: level,\r\n      current: this.conditionsMap[ number ]?.[ level ],\r\n      previousLevels: this.getPreviousLevels( number, level )\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  getPreviousLevels(conditionNumber, conditionLevel) {\r\n\r\n    // If level is 0, it's the first <If> and there is no previous levels\r\n    if(conditionLevel === 0) return []\r\n\r\n    let currentLevel = 0\r\n    const previousConditions = []\r\n\r\n    while (currentLevel < conditionLevel) {\r\n      previousConditions.push( this.conditionsMap[ conditionNumber ][ currentLevel ] )\r\n      currentLevel ++\r\n    }\r\n\r\n    return previousConditions\r\n  }\r\n\r\n  /**\r\n   * Extract standardized comparisons from defined rules\r\n   */\r\n  extractComparisons(rules) {\r\n\r\n    const comparisons = []\r\n\r\n    for (const key in rules) {\r\n\r\n      if ((key==='compare' || key.slice(0, 8)==='compare_')\r\n          || (key==='value' || key.slice(0, 6)==='value_')\r\n      ) continue\r\n\r\n      if (key==='control' || key.slice(0, 8)==='control_') {\r\n\r\n        const field = rules[key]\r\n        const [_, index = 0] = key.split('_')\r\n\r\n        comparisons.push({\r\n          field,\r\n          value:   rules[`value${ index ? '_'+index : '' }`],\r\n          compare: rules[`compare${ index ? '_'+index : '' }`],\r\n        })\r\n        continue\r\n      }\r\n\r\n      // Unknown attribute - Assume controlName=expectedValue for backward compatibility\r\n\r\n      comparisons.push({\r\n        field: key,\r\n        value: rules[key]\r\n      })\r\n    }\r\n\r\n    // console.log('extractComparisons', rules, comparisons)\r\n    return comparisons\r\n  }\r\n\r\n  evaluateCondition(condition, getFieldValue) {\r\n\r\n    let visibility = true\r\n\r\n    /**\r\n     * Current condition only applies when all other conditions from\r\n     * previous levels are false\r\n     *\r\n     * <If> -> <Else if/> -> <Else if/> ... etc\r\n     */\r\n    for (const previousCondition of condition.previousLevels) {\r\n\r\n      const comparisons = this.extractComparisons(previousCondition)\r\n\r\n      for (const { field, value, compare } of comparisons) {\r\n\r\n        const fieldValue = getFieldValue(field)\r\n\r\n        // Ignore the rest if any previous level matched\r\n        if ( this.compare(fieldValue, value, compare) ) return false\r\n      }\r\n    }\r\n\r\n    // Current condition\r\n\r\n    const comparisons = this.extractComparisons(condition.current)\r\n\r\n    for (const { field, value, compare } of comparisons) {\r\n\r\n      const fieldValue = getFieldValue(field)\r\n\r\n      // Ignore the rest if any comparison does not match\r\n      if ( !this.compare(fieldValue, value, compare) ) return false\r\n    }\r\n\r\n    return visibility\r\n  }\r\n\r\n  /**\r\n   * Shared comparison function to apply supported operators\r\n   */\r\n  compare(firstValue, secondValue, operator = 'is') {\r\n\r\n    let result = false\r\n\r\n    switch (operator) {\r\n    case 'is':\r\n    case 'equal':\r\n    case 'not':\r\n    default:\r\n      result = firstValue === secondValue\r\n      if (operator==='not') result = !result\r\n      break\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n","import ControlVisibility from '../../../template-controls-visibility'\r\n\r\nconst $ = jQuery\r\n\r\nconst setVisibility = ( \r\n  $container, \r\n  repeater,\r\n  conditions\r\n) => {\r\n\r\n  const visibility = new ControlVisibility(conditions)\r\n  \r\n  const items  = repeater.value.models\r\n  const $items = $container.find('.elementor-repeater-fields')\r\n  \r\n  items.forEach((item, i) => {\r\n    \r\n    const $item    = $($items[i])\r\n    const values   = item.attributes\r\n    const controls = item.controls\r\n\r\n    const getValue = name => ( values[ 'tangible_control_' + name ] ?? undefined )\r\n\r\n    for( const name in values ) {\r\n\r\n      const $control = $item.find(`.elementor-control-${name}`)\r\n\r\n      if( ! $control ) continue;\r\n\r\n      const conditions = controls[ name ].tangible_conditions ?? []\r\n      \r\n      const isVisible = visibility.evaluateConditions(\r\n        conditions, \r\n        getValue\r\n      )\r\n \r\n      $control[ isVisible ? 'show' : 'hide' ]()\r\n    }\r\n\r\n  })\r\n\r\n}\r\n\r\nconst refresh = () => repeater.callback ? repeater.callback() : false\r\n\r\nconst observer = new MutationObserver(\r\n  mutations => mutations.forEach( refresh ) \r\n)\r\n\r\nconst init = () => {\r\n\r\n  const repeaters = document.querySelectorAll('.elementor-repeater-fields-wrapper')\r\n\r\n  repeaters.forEach(\r\n    repeater => observer.observe(repeater, { childList: true }) \r\n  )\r\n\r\n  $('.elementor-repeater-fields elementor-control input').on('keyup change', refresh)\r\n  $('.elementor-repeater-fields elementor-control select').on('select2:select', refresh)\r\n} \r\n\r\nconst clear = () => {\r\n\r\n  observer.disconnect()\r\n\r\n  $('.elementor-repeater-fields elementor-control input').off('keyup change', refresh)\r\n  $('.elementor-repeater-fields elementor-control select').off('select2:select', refresh)\r\n}\r\n\r\nconst repeater = {\r\n  setVisibility : setVisibility,\r\n  init          : init,\r\n  clear         : clear,\r\n  callback      : false,\r\n}\r\n\r\nexport default repeater\r\n","const $ = jQuery\r\n\r\n/**\r\n * Workaround to be able to use custom tabs\r\n *\r\n * @see maybe_use_tabs_workaround() in ./includes/integrations/elementor/dynamic/base.php\r\n */\r\n\r\nexport const maybeInitTabsWorkaround = tabs => {\r\n  \r\n  if( ! tabs.content || ! tabs.content.conditions ) return\r\n  if( tabs.content.conditions !== 'default-tab-workaround' ) return\r\n\r\n  const firstTab = document.querySelector('.elementor-component-tab:not([data-tab=\"content\"])')\r\n  $(firstTab).trigger('click')\r\n}\r\n","import ControlVisibility from '../../../template-controls-visibility'\r\nimport repeater from './repeater'\r\n\r\nimport { maybeInitTabsWorkaround } from '../tabs'\r\n\r\nconst {\r\n  Tangible\r\n} = window\r\n\r\nconst { prefix, visibility } = Tangible.blockConfig\r\nconst $ = jQuery\r\n\r\nconst {\r\n  conditions,\r\n  tabs: tabsByBlock,\r\n  sections: sectionsByBlock\r\n} = visibility\r\n\r\n/**\r\n * Hide/Show fields according to conditions, for a given widget (if any)\r\n *\r\n * @see index.js\r\n */\r\nexport const widgetVisibility = currentWidget => {\r\n\r\n  const widgdetName = currentWidget.attributes.widgetType\r\n\r\n  if( ! widgdetName.startsWith(prefix.slug) ) return\r\n\r\n  const blockId = widgdetName.slice(prefix.slug.length)\r\n  const controls = getBlockControls(blockId)\r\n\r\n  let tabs = tabsByBlock[blockId] || {}\r\n  let sections = sectionsByBlock[blockId] || {}\r\n\r\n  // When an object is empty, PHP's json_encode passes an array\r\n  if (Array.isArray(tabs)) tabs = {}\r\n  if (Array.isArray(sections)) sections = {}\r\n\r\n  const visibility = new ControlVisibility(\r\n    conditions[ blockId ].general\r\n  )\r\n\r\n  const getElementorSettings = () => currentWidget.get('settings').attributes\r\n  const refresh = () => {\r\n    \r\n    $('.elementor-control-type-section').off('click', refresh)\r\n    $('.elementor-control input').off('keyup change', refresh)\r\n    $('.elementor-control select').off('select2:select', refresh)\r\n    $('.elementor-component-tab').off('click', refresh)\r\n    \r\n    repeater.clear()\r\n\r\n    setVisibility({\r\n      controls,\r\n      visibility,\r\n      elementorSettings: getElementorSettings(),\r\n      tabs,\r\n      sections,\r\n      blockId\r\n    })\r\n\r\n    $('.elementor-control-type-section').on('click', refresh)\r\n    $('.elementor-control input').on('keyup change', refresh)\r\n    $('.elementor-control select').on('select2:select', refresh)\r\n    $('.elementor-component-tab').on('click', refresh)\r\n\r\n    repeater.init()\r\n\r\n  }\r\n\r\n  maybeInitTabsWorkaround(tabs)\r\n  repeater.callback = refresh \r\n  \r\n  refresh() // Initial visibility\r\n}\r\n\r\n/**\r\n * Get the info needed from ElementorConfig according to block id\r\n */\r\nconst getBlockControls = blockId => {\r\n\r\n  const widgetName = prefix.slug + blockId\r\n  const controls = elementor.widgetsCache[ widgetName ].controls\r\n  const tangibleControls = {}\r\n\r\n  for( const controlName in controls ) {\r\n\r\n    if( ! controlName.startsWith(prefix.control) ) continue\r\n\r\n    tangibleControls[ controlName ] = controls[ controlName ]\r\n  }\r\n\r\n  return tangibleControls\r\n}\r\n\r\nconst element = name => ( $('#elementor-controls').find(`[data-setting='${ name }']`) )\r\n\r\n/**\r\n * Evaluate and apply visibility of tabs/sections/fields\r\n */\r\nconst setVisibility = ({\r\n  controls,\r\n  visibility,\r\n  elementorSettings,\r\n  tabs,\r\n  sections,\r\n  blockId\r\n}) => {\r\n\r\n  const controlSettings = getControlSettings(controls, elementorSettings)\r\n\r\n  const getFieldValue = name => controlSettings[ name ]\r\n    ? controlSettings[ name ].value\r\n    : undefined\r\n\r\n  // Tabs\r\n\r\n  for (const tabName of Object.keys(tabs)) {\r\n\r\n    const tab = tabs[tabName]\r\n\r\n    const isVisible = tab.conditions === 'default-tab-workaround'\r\n      ? false\r\n      : visibility.evaluateConditions(\r\n        tab.conditions,\r\n        getFieldValue\r\n      )\r\n\r\n    const $tab = $(`.elementor-tab-control-${tabName}`)\r\n\r\n    // Currently active tab is always visible\r\n    if ($tab.hasClass('elementor-active')) continue\r\n\r\n    $tab[ isVisible ? 'show' : 'hide' ]()\r\n  }\r\n\r\n  // Sections\r\n\r\n  for (const sectionName of Object.keys(sections)) {\r\n\r\n    const section = sections[sectionName]\r\n\r\n    const isVisible = visibility.evaluateConditions(\r\n      section.conditions,\r\n      getFieldValue\r\n    )\r\n\r\n    const $section = $(`.elementor-control-tangible_section_${sectionName}`)\r\n\r\n    // Currently open section is always visible\r\n    if ($section.hasClass('elementor-open')) continue\r\n\r\n    $section[ isVisible ? 'show' : 'hide' ]()\r\n  }\r\n\r\n  // Controls\r\n\r\n  for( const controlName in controlSettings ) {\r\n\r\n    const control = controlSettings[ controlName ]\r\n\r\n    const isVisible = visibility.evaluateConditions(\r\n      control.conditions,\r\n      getFieldValue\r\n    )\r\n\r\n    const $control = $(`.elementor-control-${control.dataName}`)\r\n\r\n    $control[ isVisible ? 'show' : 'hide' ]()\r\n\r\n    const repeaterConditions = conditions[ blockId ].repeater[ controlName ] ?? false\r\n\r\n    if( ! repeaterConditions ) continue;\r\n  \r\n    setTimeout( // :(\r\n      () => repeater.setVisibility( \r\n        $control, \r\n        control,\r\n        repeaterConditions\r\n      )\r\n    ) \r\n  }\r\n}\r\n\r\nconst getControlSettings = (controls, elementorSettings) => {\r\n\r\n  const settings = {}\r\n\r\n  for( const control in controls ) {\r\n\r\n    const setting = {\r\n      value:    getValue(elementorSettings[ control ], controls[ control ]),\r\n      dataName: control,\r\n      name:     control.slice(prefix.control.length)\r\n    }\r\n\r\n    if( controls[ control ].tangible_conditions ) {\r\n      setting.conditions = controls[ control ].tangible_conditions\r\n    }\r\n\r\n    settings[ setting.name ] = setting\r\n  }\r\n\r\n  return settings\r\n}\r\n\r\nconst getValue = (value, control) => {\r\n\r\n  if ( control.type !== 'number' && control.type !== 'switcher' ) return value\r\n\r\n  if ( control.type === 'number' ) return value ? value.toString() : value\r\n\r\n  const $switch = element(control.name)\r\n\r\n  // We can trust elementor switch value when value comes from a section that is not currently open\r\n  if( $switch.length === 0 ) return value\r\n\r\n  // Otherwise we get value ourself because it will be inaccurate\r\n  return $switch.is(':checked') ? control.return_value : control.return_off\r\n}\r\n","import { widgetVisibility } from './visibility/general'\r\n\r\njQuery(() => {\r\n\r\n  /**\r\n   * Triggered each time Elementor's editor open something\r\n   */\r\n  elementor.hooks.addAction( 'panel/open_editor/widget', (panel, model) => {\r\n    \r\n    if( model.attributes.elType !== 'widget' ) return;\r\n\r\n    widgetVisibility(model)\r\n    \r\n  })\r\n\r\n})\r\n\r\n","const Modal = props => {\r\n  \r\n  return (\r\n    <div id=\"tangible-logic-root\" className=\"tangible-logic-open\">\r\n      <div className=\"tangible-logic-modal\">\r\n        <div className=\"tangible-logic-header\">\r\n          <div className=\"tangible-logic-title\">{ props.title ? props.title : '' }</div>\r\n          <button id=\"logic-button-cancel\" className=\"tangible-components-button has-icon\" type=\"button\" aria-label=\"Close dialog\" onClick={ props.cancel }>\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\"\r\n              width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" role=\"img\"\r\n              aria-hidden=\"true\" focusable=\"false\">\r\n              <path\r\n                d=\"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z\">\r\n              </path>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"tangible-logic-rule-group\">\r\n          { props.children }\r\n        </div>\r\n\r\n        <div className=\"tangible-logic-actions tangible-logic-clear\">\r\n          <button id=\"logic-button-cancel\" className=\"tangible-components-button is-tertiary\" type=\"button\" onClick={ props.cancel }>Cancel</button>\r\n          <button id=\"logic-button-add-logic\" className=\"tangible-components-button is-primary\" type=\"button\" onClick={ props.submit }>Save</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Modal\r\n","const getControl = (\n  handler, \n  value, \n  props,\n  builder\n) => (\n  tangibleFields.render({\n    context: builder === 'gutenberg' ? 'wp' : builder,\n    onChange: value => handler(\n      Array.isArray(value) || typeof value === 'object'\n        ? JSON.stringify(value) \n        : String(value)\n    ),\n    ...props,\n    value: value, // Important: Value must not be overwrited by props \n    portalContainer: builder === 'beaver-builder' \n      ? window.parent.document.body\n      : document.body\n  })\n)\n\nexport { getControl }\n","import { \r\n  useState, \r\n  useEffect \r\n} from 'react'\r\n\r\nimport Modal from '../common/modal/Modal'\r\nimport { getControl } from './'\r\n\r\nconst Control = props => {\r\n\r\n  const { \r\n    config, \r\n    field, \r\n    builder, \r\n    initialValue \r\n  } = props\r\n\r\n  const isPopup = config.popup\r\n\r\n  const [isOpen, setIsOpen] = useState(builder === 'beaver-builder')\r\n  const [value = initialValue, setValue] = useState()\r\n  const [saved = initialValue, setSaved] = useState()\r\n  \r\n  const save = data => isPopup ? setValue(data) : (setSaved(data), setValue(data))\r\n\r\n  useEffect(() => props.save(saved), [saved])\r\n  useEffect(() => isPopup && isOpen && setValue(saved), [isOpen])\r\n\r\n  const control =\r\n    <div className={ `tangible-block-control tangible-block-control-${config.type}` }>\r\n      { getControl(save, saved, field, builder) }\r\n    </div>\r\n  \r\n  if( ! isPopup ) return control;\r\n\r\n  const cancel = () => setIsOpen(false)\r\n  const submit = () => { setIsOpen(false), setSaved(value) }\r\n  \r\n  /**\r\n   * The button/onClick logic is not handled here in the case of beaver-builder because we need to create \r\n   * the button and the popup at 2 different places in the DOM\r\n   * \r\n   * @see assets/src/beaver-template-editor/fields/dynamic/index.js\r\n   */\r\n\r\n  const button = builder !== 'beaver-builder' &&\r\n    <div className={ `tangible-control-modal-button-container tangible-control-modal-button-container-${builder}` }>\r\n\r\n      { builder === 'elementor' && \r\n        <label className='elementor-control-title'>\r\n          { field.label }\r\n        </label> }\r\n    \r\n      <button onClick={ () => setIsOpen(!isOpen) } class=\"components-button is-secondary tangible-control-btn\">\r\n        Open Settings\r\n      </button>\r\n    </div>\r\n    \r\n\r\n  if( ! isOpen ) return button;\r\n\r\n  return(\r\n    <>\r\n      { button }\r\n      <Modal submit={ submit } cancel={ cancel } title={ field.label }>\r\n        { control }\r\n      </Modal>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Control\r\n","const { wp } = window\r\nconst { useState, useEffect } = wp.element\r\n\r\n/**\r\n * Temporary test field (keep as a fallback?) until we start moving real custom componenets\r\n * in this system\r\n */\r\n\r\nconst Text = props => {\r\n\r\n  const [value, setValue] = useState(props.initialValue)\r\n\r\n  useEffect(() => props.handler(value), [value])\r\n\r\n  return(\r\n    <input type=\"text\" value={ value } onChange={ (e) => setValue(e.target.value) }/>\r\n  )\r\n}\r\n\r\nexport default Text\r\n","import { useEffect, useRef } from 'react' // Aliased from Tangible.Preact || wp.element\r\n\r\n/**\r\n * Wrap Select2 module from vendor/tangible/interface\r\n *\r\n * @see https://select2.org/\r\n *\r\n * Also used in ../template-import-export\r\n */\r\nconst { jQuery: $ } = window\r\n\r\nconst Select = ({\r\n  labelForEmptyValue = '',\r\n  options = [],\r\n  value = '',\r\n  onChange,\r\n  multiSelect,\r\n  style\r\n}) => {\r\n\r\n  const ref = useRef()\r\n\r\n  /**\r\n   * Activate Select2\r\n   */\r\n\r\n  useEffect(() => {\r\n\r\n    if ( !ref.current ) return\r\n\r\n    const $el = $(ref.current)\r\n    ref.current.$el = $el\r\n\r\n    onChange(value)\r\n\r\n    $el.tangibleSelect({\r\n      minimumResultsForSearch: 5\r\n    })\r\n\r\n    if (multiSelect) {\r\n      // Ensure multiple values are selected on mount\r\n      $el.val(value)\r\n      $el.trigger('change')\r\n    }\r\n\r\n    $el.on('change', function(e) {\r\n\r\n      if ( !multiSelect && !ref.current._silentChange ) {\r\n        onChange(e.target.value)\r\n        return\r\n      }\r\n\r\n      if ( !ref.current || ref.current._silentChange ) return\r\n\r\n      // Ensure array of values for multi-select\r\n\r\n      const values = $el.select2('data').map(item => item.id)\r\n      onChange(values)\r\n    })\r\n\r\n    const select2 = ref.current.select2 = $el.data('select2')\r\n\r\n    // Clean up when component removed\r\n    return () => {\r\n      select2 && select2.destroy()\r\n    }\r\n\r\n  }, []) // NOTE: Empty array to run only once on component mount\r\n\r\n  // Ensure Select2 shows current value\r\n  if (ref.current && ref.current.$el) {\r\n    if (multiSelect) {\r\n      const currentValues = ref.current.$el.val()\r\n      if (value.length!==currentValues.length && options.length) {\r\n        // After select is rendered with options\r\n        setTimeout(function() {\r\n          if (!ref.current || !ref.current.$el) return\r\n          ref.current.$el.val(value)\r\n          ref.current.$el.trigger('change')\r\n        }, 0)\r\n      }\r\n    } else if (ref.current.value!==value) {\r\n\r\n      /**\r\n       * TODO: Temporary workaround to prevent PostQuery control from causing infinite loop in\r\n       * /assets/src/template-block-fields/fields/post-query/Order.jsx, onChange()\r\n       */\r\n      ref.current._silentChange = true\r\n\r\n      ref.current.$el.val(value)\r\n      ref.current.$el.trigger('change')\r\n\r\n      setTimeout(function() {\r\n        ref.current._silentChange = false\r\n      }, 0)\r\n    }\r\n  }\r\n\r\n  return <select\r\n    ref={ref}\r\n    // onChange={e => onChange(e.target.value)}\r\n    autoComplete='off'\r\n    multiple={multiSelect}\r\n    style={{\r\n      display: 'none',\r\n      width: '160px', // Default width\r\n      ...style\r\n    }}\r\n  >\r\n    { labelForEmptyValue &&\r\n       <option value=\"\" disabled={true} selected={value==null}>{ labelForEmptyValue }</option>\r\n    }\r\n    { options.map((option, optionIndex) =>\r\n      <option\r\n        key={`option-${optionIndex}`}\r\n        value={option.value}\r\n        selected={option.value===value}\r\n      >{option.label}</option>\r\n    )}\r\n\r\n  </select>\r\n}\r\n\r\nexport default Select\r\n","import Select from \"../../../common/Select\";\r\n\r\nconst Order = ({ getData, setData, includeOrder, includeOrderBy }) => {\r\n\r\n  // Order label and select\r\n  const order = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\" htmlFor=\"order\">Order</label>\r\n      <Select\r\n        labelForEmptyValue=\"Choose Order\"\r\n        options={[ { label: 'ASC', value: 'asc' }, { label: 'DESC', value: 'desc' } ]}\r\n        value={ getData('order') }\r\n        style={{ width: '100%' }}\r\n        onChange={ value => setData( 'order', value ) }\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  // Orderby label and select\r\n  const orderByOptions = [\r\n    { label: 'Title', value: 'title'},\r\n    { label: 'ID', value: 'id'},\r\n    { label: 'Author', value: 'author'},\r\n    { label: 'Name', value: 'name'},\r\n    { label: 'Type', value: 'type'},\r\n    { label: 'Date', value: 'date'},\r\n    { label: 'Modified', value: 'modified'},\r\n    { label: 'Random', value: 'random'},\r\n    { label: 'Comment count', value: 'comment_count'},\r\n    { label: 'Relevance', value: 'relevance'},\r\n    { label: 'Menu', value: 'menu'},\r\n    { label: 'Custom value', value: 'meta_value'},\r\n    { label: 'Custom value number', value: 'meta_value_num'},\r\n  ]\r\n  const orderBy = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\" htmlFor=\"orderby\">Order by</label>\r\n      <Select\r\n        labelForEmptyValue=\"Order by\"\r\n        options={ orderByOptions }\r\n        value={ getData('orderby') }\r\n        style={{ width: '100%' }}\r\n        onChange={ value => setData( 'orderby', value ) }\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  // Orderbyfield label and select\r\n  // Could use argument _builtin in query to get select?\r\n  const orderByField = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\" htmlFor=\"orderby_field\">Order by custom field</label>\r\n      <input\r\n        className=\"tangible-components-text-control__input\"\r\n        type=\"text\" name=\"orderby-field\" id=\"orderby_field\"\r\n        onChange={ e => setData( 'orderby_field', e.target.value ) }\r\n        placeholder=\"Enter field key\"\r\n        value={ getData('orderby_field')}\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  // Custom field whose value is a number\r\n  const orderByFieldNumber = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\" htmlFor=\"orderby_field_number\">Order by custom field with numeric value</label>\r\n      <input\r\n        className=\"tangible-components-text-control__input\"\r\n        type=\"text\" id=\"orderby_field_number\" name=\"orderby-field-number\"\r\n        onChange={ e => setData( 'orderby_field_number', e.target.value ) }\r\n        placeholder=\"Enter field key\"\r\n        value={ getData('orderby_field_number')}\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n\r\n  return (\r\n    <div className='tangible-logic-rule'>\r\n      { includeOrder && order }\r\n      { includeOrderBy && orderBy }\r\n      { getData('orderby') === 'meta_value' && orderByField }\r\n      { getData('orderby') === 'meta_value_num' && orderByFieldNumber }\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Order\r\n","import Select from \"../../../common/Select\";\r\n\r\nconst { useState, useEffect } = wp.element\r\n\r\nconst Type = ({ initialLoopType, initialType, setData, fields }) => {\r\n\r\n  const [loopType, setLoopType] = useState(initialLoopType ? initialLoopType : 'post')\r\n  const [type, setType] = useState(initialType)\r\n\r\n  useEffect(() => setData('loopType', loopType), [loopType])\r\n  useEffect(() => setData('type', type), [type])\r\n\r\n  // Core content types (Only post supported for now)\r\n  const contentTypeOptions = [\r\n    { label: 'Post', value: 'post'},\r\n    // { label: 'Attachment', value: 'attachment'},\r\n    // { label: 'Taxonomy', value: 'taxonomy'},\r\n    // { label: 'Taxonomy Term', value: 'taxonomy term'},\r\n    // { label: 'User', value: 'user'},\r\n    // { label: 'Calendar', value: 'calendar'},\r\n  ]\r\n\r\n  const contentType = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\">Content type</label>\r\n      <Select\r\n        labelForEmptyValue=\"Choose a Type\"\r\n        options={ contentTypeOptions }\r\n        value={ loopType }\r\n        onChange={ value => setLoopType(value) }\r\n        style={{ width: '100%' }}\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  // Fields associated with this 'content type'\r\n  const contentFields = loopType === 'post' \r\n    ? <div className=\"tangible-components-control\">\r\n        <div className=\"tangible-components-control__field\">\r\n          <label className=\"tangible-components-control__label\" htmlFor=\"post_type\">Fields</label>\r\n          <Select\r\n            labelForEmptyValue=\"Choose Fields\"\r\n            value={ type ? type.split(',') : ['null'] }\r\n            options={ fields }\r\n            multiSelect={ true }\r\n            style={{ width: '100%' }}\r\n            onChange={ values => values == 'null'\r\n              ? setType('')\r\n              : setType(values.toString())\r\n            }\r\n          />\r\n        </div>\r\n      </div> \r\n    : ''\r\n\r\n\r\n  return (\r\n    <div className='tangible-logic-rule'>\r\n      { contentType }\r\n      { contentFields }\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Type\r\n","import Select from '../../../common/Select';\r\n\r\nconst { Tangible, wp } = window\r\nconst { useState, useEffect } = wp.element\r\n\r\n// Data from /includes/block/controls/types/post-query.php\r\nconst {\r\n  allTaxonomies = {}\r\n} = Tangible.postQueryControlData\r\n\r\n\r\nconst QueryGroup = ({ value, initialData, save, showBtn, remove }) => {\r\n\r\n  const isFirst = value === 1\r\n  const taxonomies = Object.keys(allTaxonomies)\r\n  const [ params, setParams ] = useState( initialData )\r\n\r\n  useEffect( () => {\r\n    save( params )\r\n  }, [ params ])\r\n\r\n  const getTerms = ( selectedTaxonomy ) => {\r\n    const terms = allTaxonomies[ selectedTaxonomy ]\r\n\r\n    if ( terms == null || terms.length === 0 ) return []\r\n\r\n    let options = []\r\n    terms.forEach( term => {\r\n      options.push({ label: term.name, value: term.slug })\r\n    })\r\n    return options\r\n  }\r\n\r\n  const getParam = ( x ) => {\r\n    if ( params.hasOwnProperty(x) ){\r\n      if ( params[x] === '' ) return null\r\n      return params[x]\r\n    }\r\n    return null\r\n  }\r\n\r\n  const updateTerms = ( value ) => {\r\n    // Reinitialize options - Forcing re-render\r\n    setTermOptions( oldTerms => {\r\n      return []\r\n    } )\r\n\r\n    if ( value.length > 0 ){\r\n      setTermOptions( oldTerms => {\r\n        return value\r\n      } )\r\n    }\r\n  }\r\n\r\n  const updateParam = ( field, value ) => setParams( oldParams => {\r\n    return { ...oldParams, [ field ]: value }\r\n  })\r\n\r\n  const [ termOptions, setTermOptions ] = useState(\r\n    params.hasOwnProperty(`taxonomy`) ? getTerms( params[`taxonomy`] ) : []\r\n  )\r\n\r\n  const option = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\">Taxonomy { !isFirst && value }</label>\r\n      <Select\r\n        style={{ width: '100%' }}\r\n        labelForEmptyValue={ `Taxonomy ${ isFirst ? '' : value }` }\r\n        options={ taxonomies.map( tax => {\r\n          return { label: tax, value: tax }\r\n        } )}\r\n        value={ getParam(`taxonomy`) }\r\n        onChange={ value => {\r\n          updateParam( 'terms', '')\r\n          updateParam( 'taxonomy', value)\r\n\r\n          const newTerms = getTerms( value )\r\n          updateTerms( newTerms )\r\n        } }\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  const compare = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\">Compare { !isFirst && value }</label>\r\n      <Select\r\n        style={{ width: '100%' }}\r\n        labelForEmptyValue={ `Compare ${ isFirst ? '' : value }` }\r\n        options={[\r\n          { label: 'In', value: 'in'},\r\n          { label: 'Not', value: 'not'},\r\n          { label: 'And', value: 'and'},\r\n          { label: 'Exists', value: 'exists'},\r\n          { label: 'Not exists', value: 'not exists'},\r\n        ]}\r\n        value={ params.taxonomy_compare }\r\n        onChange={ value => updateParam(`taxonomy_compare`, value) }\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  const selectedValues = getParam(`terms`)\r\n  const values = <div className=\"tangible-components-control\">\r\n    <div className=\"tangible-components-control__field\">\r\n      <label className=\"tangible-components-control__label\">Term { !isFirst && value }</label>\r\n      <Select\r\n        style={{ width: '100%' }}\r\n        labelForEmptyValue={ `Terms ${ isFirst ? '' : value }` }\r\n        multiSelect={ true }\r\n        options={ termOptions }\r\n        value={ selectedValues ? selectedValues.split(',') : ['null'] }\r\n        onChange={ values => setParams( oldParams => {\r\n          let selection = ''\r\n          if ( values != 'null' ) selection = values.toString()\r\n\r\n          return { ...oldParams, [`terms`]: selection }\r\n        }) }\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n\r\n  return (\r\n    <div className=\"tangible-logic-rule\">\r\n      { option }\r\n      { compare }\r\n      { values }\r\n\r\n      { showBtn &&\r\n      <button id=\"logic-button-rule\" className=\"tangible-components-button is-secondary\" type=\"button\" onClick={ remove }>\r\n        Remove\r\n      </button>\r\n      }\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default QueryGroup\r\n","import QueryGroup from './query-group'\r\nimport Select from \"../../../common/Select\"\r\n\r\nconst { wp } = window\r\nconst { useState, useEffect } = wp.element\r\nconst MAXQUERYNUMBER = 3 // Only a max of 3 are supported at the moment\r\n\r\n// Not checking whether queries 1-3 are choosing the same taxonomy\r\n// Do we want Query relation to be and on default?\r\nconst Taxonomy = ({ initialData, save }) => {\r\n\r\n  const [rows, setRows] = useState([])\r\n  const [relation, setRelation] = useState('')\r\n\r\n  /**\r\n   * Convert previously saved json to an array\r\n   */\r\n  useEffect(() => {\r\n\r\n    if( !initialData ) return;\r\n\r\n    const data = JSON.parse(initialData)\r\n    const initialRows = []\r\n\r\n    if( data.taxonomy_relation ) setRelation(data.taxonomy_relation)\r\n    if( !data.taxonomy ) return;\r\n\r\n    let suffix = ''\r\n    let i = 1\r\n\r\n    while(data[`taxonomy${suffix}`] && i <= MAXQUERYNUMBER) {\r\n\r\n      suffix = i !== 1 ? `_${i}` : ''\r\n\r\n      if( !data[`taxonomy${suffix}`] ) break;\r\n\r\n      initialRows.push({\r\n        taxonomy: data[`taxonomy${suffix}`], \r\n        terms:  data[`terms${suffix}`],\r\n        taxonomy_compare:  data[`taxonomy_compare${suffix}`]\r\n      })\r\n      i++\r\n    }\r\n\r\n    setRows(initialRows)\r\n  }, [])\r\n\r\n  /**\r\n   * Convert and save our array to data expected by the save (taxnonomy, taxnonomy_2 ... etc)\r\n   */\r\n  useEffect(() => {\r\n\r\n    const savedData = {}\r\n\r\n    if( relation ) savedData.taxonomy_relation = relation\r\n\r\n    for (let i = 0; i < rows.length; i++) {\r\n      \r\n      const suffix = i !== 0 ? `_${i + 1}` : ''\r\n\r\n      savedData[`taxonomy${suffix}`] = rows[i].taxonomy\r\n      savedData[`terms${suffix}`] = rows[i].terms\r\n      savedData[`taxonomy_compare${suffix}`] = rows[i].taxonomy_compare\r\n    }\r\n\r\n    save(savedData)\r\n  }, [rows, relation])\r\n\r\n  const taxonomyRelation = <div className=\"tangible-logic-rule tangible-logic-clear\">\r\n    <div className=\"tangible-components-control\">\r\n      <div className=\"tangible-components-control__field\">\r\n        <label className=\"tangible-components-control__label\">Relation</label>\r\n        <Select\r\n          style={{ width: '100%' }}\r\n          labelForEmptyValue=\"Choose Relation\"\r\n          options={[ \r\n            { label: 'And', value: 'and'}, \r\n            { label: 'Or', value: 'or'} ]}\r\n          value={ relation }\r\n          onChange={ value => setRelation(value) }\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  const addRow = () => {\r\n    setRows([...rows, { \r\n      taxonomy: '', \r\n      terms: '',\r\n      taxonomy_compare: ''\r\n    }])\r\n  } \r\n\r\n  const saveRow = (index, data) => {\r\n    rows[index] = data\r\n    setRows([...rows])\r\n  }\r\n\r\n  const removeRow = index => {\r\n    setRows([\r\n      ...rows.slice(0, index),\r\n      ...rows.slice(index + 1) ])\r\n  }\r\n\r\n  return (\r\n    <div className=\"tangible-logic-rule-group-box-bordered\">\r\n\r\n      { rows.length > 1 &&\r\n        <div className=\"tangible-logic-taxonomy-group\">\r\n          { taxonomyRelation }\r\n        </div>\r\n      }\r\n\r\n      <div className=\"tangible-logic-taxonomy-group\">\r\n        { rows.length > 0 && rows.map((item, i) => (\r\n          <QueryGroup\r\n            key={ i + JSON.stringify(item) }\r\n            value={ i + 1 }\r\n            initialData={ item }\r\n            showBtn={ true }\r\n            save={ data => saveRow(i, data) }\r\n            remove={ () => removeRow(i) }\r\n          />\r\n        ))}\r\n      </div>\r\n    \r\n    { rows.length < MAXQUERYNUMBER &&\r\n      <div className=\"tangible-logic-group-actions\">\r\n        <button className=\"tangible-components-button is-secondary\" type=\"button\" onClick={ addRow }>\r\n          Add taxonomy filter\r\n        </button>\r\n        <button className=\"tangible-components-button is-secondary\" type=\"button\" onClick={ () => setRows([]) }>\r\n          Remove\r\n        </button>\r\n      </div> \r\n    }\r\n    \r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Taxonomy\r\n","import Order from './Order';\r\nimport Type from './Type';\r\nimport Taxonomy from '../taxonomy'\r\n\r\nconst { Tangible, wp } = window\r\nconst { useState, useEffect } = wp.element\r\n\r\nconst {\r\n  allPostTypes = {}\r\n} = Tangible.postQueryControlData || {}\r\n\r\n\r\nconst PostQuery = ({ initialData, save, fields = [] }) => {\r\n\r\n  const fieldList = fields.replace(/\\s+/g, '').split(',')\r\n\r\n  const parseData = json => {\r\n    try { return JSON.parse(json) } \r\n    catch { return {} }\r\n  }\r\n\r\n  const [args, setArgs] = useState( parseData(initialData) )\r\n\r\n  useEffect(() => setArgs( parseData(initialData) ), [initialData])\r\n\r\n  // Update result\r\n  useEffect( () => {\r\n    save( args )\r\n  }, [ args ])\r\n\r\n  // Getter function used by child components of Post Query\r\n  const getData = key => {\r\n    return args[key] && args[key] !== ''\r\n      ? args[key]\r\n      : null\r\n  }\r\n\r\n  // Setter function used by child components of Post Query\r\n  const updateArgs = ( field, value ) => setArgs( oldArgs => {\r\n\r\n    if( field !== 'orderby' ) return { ...oldArgs, [ field ]: value }\r\n    \r\n    if( value !== 'meta_value' && oldArgs.orderby_field ) {\r\n      delete oldArgs.orderby_field\r\n    }\r\n\r\n    if( value !== 'meta_value_num' && oldArgs.orderby_field_number ) {\r\n      delete oldArgs.orderby_field_number\r\n    }\r\n\r\n    return { ...oldArgs, [ field ]: value }\r\n  })\r\n\r\n  // Taxonomy child component\r\n  const taxonomy = <Taxonomy\r\n    initialData={ args.hasOwnProperty('taxonomies') ? JSON.stringify( args.taxonomies ) : '{}' }\r\n    save={ newParams => updateArgs( 'taxonomies', newParams ) }\r\n  />\r\n\r\n  return (\r\n    <>\r\n      { ( fieldList.includes('order') || fieldList.includes('orderby') ) &&\r\n        <div className='tangible-logic-rule-group-box'>\r\n          <h4 style={{ fontWeight: '600' }}>Order</h4>\r\n          <Order\r\n            getData={ getData }\r\n            setData={ updateArgs }\r\n            includeOrder={ fieldList.includes('order') }\r\n            includeOrderBy={ fieldList.includes('orderby') }\r\n          />\r\n        </div>\r\n      }\r\n\r\n      { fieldList.includes('type') &&\r\n        <div className='tangible-logic-rule-group-box'>\r\n          <h4 style={{ fontWeight: '600' }}>Type</h4>\r\n          <Type\r\n            initialLoopType={ getData('loopType') !== null ? getData('loopType') : 'post' }\r\n            initialType={ getData('type') }\r\n            setData={ updateArgs }\r\n            fields={ Object.keys( allPostTypes ).map( val => {\r\n              return { label: allPostTypes[val], value: val }\r\n            }) }\r\n          />\r\n        </div>\r\n      }\r\n\r\n      { fieldList.includes('taxonomy') &&\r\n        <div className='tangible-logic-rule-group-box'>\r\n          <h4 style={{ fontWeight: '600' }}>Filter by Taxonomy</h4>\r\n          { taxonomy }\r\n        </div>\r\n      }\r\n    </>\r\n  )\r\n}\r\n\r\nexport default PostQuery\r\n","const { wp } = window\r\nconst {\r\n  element: { useEffect, useState }\r\n} = wp\r\nconst { ajax } = window.Tangible\r\n\r\nconst AjaxSelect = ({ handler, initialValue, fields = [] }) => {\r\n\r\n  const [value, setValue] = useState(initialValue ? JSON.parse(initialValue) : [])\r\n  const [search, setSearch] = useState('')\r\n\r\n  const [options, setOptions] = useState( [] )\r\n  const [isOpen, setIsOpen] = useState( false )\r\n\r\n  const className = `tangible-block-editor-control-ajax-select`\r\n  const isMultiple = fields.multiple && fields.multiple === 'true'\r\n  \r\n  /**\r\n   * Value can be a string even if isMultiple is true, if default value is a string \r\n   */\r\n  useEffect(() => {\r\n    if( isMultiple && ! Array.isArray(value) ) setValue([ value ])\r\n  })\r\n\r\n  useEffect(() => {\r\n\r\n    const data = {\r\n      'search': search,\r\n      'field': fields // Pass all field's attributes in case it's needed by ajax action\r\n    }\r\n\r\n    ajax(fields.ajax_action_name, data)\r\n      .then(results => setOptions(results))\r\n      .catch(errors => console.error(errors))\r\n\r\n  }, [search]) \r\n\r\n  useEffect(() => handler(JSON.stringify(value)), [value])\r\n  useEffect(() => {\r\n    if( isOpen === false ) setSearch('')\r\n  }, [isOpen])\r\n\r\n  const saveValue = (saveValue) => {\r\n    \r\n    if( isMultiple ){\r\n      setValue([...value, saveValue])\r\n    } else {\r\n      setValue([saveValue])\r\n    }\r\n  }\r\n\r\n  const removeValue = (removeValue) => {\r\n\r\n    const currentValue = value.filter(\r\n      val => (val.value !== removeValue.value)\r\n    )\r\n\r\n    setValue([...currentValue])\r\n  }\r\n\r\n  const selectedValues = Array.isArray(value) ? value.map(item => (item.value)) : []\r\n  const crossIcon = <span className='dashicons dashicons-no-alt'></span>\r\n\r\n  return(\r\n    <div className={ isOpen ? `${className} is-open` : className }>\r\n      { isMultiple && Array.isArray(value) ? \r\n        <ul className={ className + '-choice' } >  \r\n          { value.map((val) => (\r\n            <li \r\n              id={ val.name } \r\n            ><button onClick={ () => removeValue(val) }>{ crossIcon }</button> <span>{val.label}</span> </li>\r\n          )) }\r\n        </ul> \r\n        : ''\r\n      }\r\n      <input \r\n        type=\"text\"\r\n        className={ className + '-input' }\r\n        onFocus={ () => setIsOpen(true) }\r\n        onBlur={ () => setIsOpen(false) }\r\n        onChange={(e) => {\r\n          setSearch( e.target.value )\r\n        }}\r\n        placeholder={ fields.placeholder ? fields.placeholder : 'Select' }\r\n        value={ !isOpen && !isMultiple && value[0] ? value[0].label : search }\r\n      />  \r\n      { isOpen && (<ul \r\n          class={className+'-ul'}\r\n        >\r\n        { options ? \r\n          options.map((option) => {\r\n\r\n            if( isMultiple && selectedValues.includes(option.value) ) return ''\r\n\r\n            /**\r\n             * Use on onMouseDown instead of onClick otherwise it conflict with onBlur\r\n             * \r\n             * @see https://stackoverflow.com/a/44142331/10491705\r\n             */\r\n            return( <li \r\n                id={ option.name } \r\n                onMouseDown={ () => saveValue(option) } \r\n              >{ option.label !== '' \r\n                ? option.label \r\n                : <i>Untitled</i> }\r\n              </li> )\r\n          }) \r\n          : ''\r\n        }\r\n      </ul>) }\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AjaxSelect\r\n","import Text from './Text'\r\nimport PostQuery from './post-query/PostQuery'\r\nimport Taxonomy from './taxonomy'\r\nimport Select from '../../common/Select'\r\nimport AjaxSelect from './ajax-select'\r\n\r\nexport const getLegacyControl = (control, handler, value, field) => {\r\n\r\n  switch(control.type) {\r\n\r\n    case 'post_query':\r\n      return <PostQuery\r\n        save={ value => handler(JSON.stringify(value)) }\r\n        initialData={ value }\r\n        fields={ field.include_fields ? field.include_fields : 'type, order, orderby' }\r\n      />\r\n\r\n    /**\r\n     * Not ready yet: Needs to determine what kind of render we want when used as a separate control\r\n     */\r\n    case 'taxonomy':\r\n      return <Taxonomy save={ value => handler( JSON.stringify( value ) ) } initialData={ value } { ...field } />\r\n\r\n    case 'select2':\r\n\r\n      const isMultiple = field.multiple && field.multiple === 'true'\r\n      const selectValue = typeof value === 'string' && isMultiple\r\n        ? ( value !== '' ? value.split(',') : [] )\r\n        : ( value !== '' ? value : null )\r\n      \r\n      return <Select\r\n        labelForEmptyValue='Choose...'\r\n        options={ field.options\r\n          ? Object.keys(field.options).map(key => ({ value: key, label: field.options[key] }))\r\n          : [] }\r\n        onChange={ value => value !== null\r\n          ? handler( Array.isArray(value) ? value.join(',') : value )\r\n          : handler('') }\r\n        multiSelect={ isMultiple }\r\n        value={ selectValue }\r\n        style={{ width: '100%' }}\r\n      />\r\n\r\n    case 'ajax_select':\r\n      return <AjaxSelect handler={ handler } initialValue={ value } fields={ field } />\r\n\r\n    // Fallback to a text field\r\n    default:\r\n      return <Text handler={ handler } initialValue={ value } { ...field } />\r\n\r\n  }\r\n}\r\n","import Modal from '../../common/modal/Modal'\r\nimport { getLegacyControl } from './'\r\n\r\nconst { useState, useEffect } = wp.element\r\n\r\nconst LegacyControl = props => {\r\n\r\n  const { config, field, builder, initialValue } = props\r\n\r\n  const isPopup = config.popup\r\n\r\n  const [isOpen, setIsOpen] = useState(builder === 'beaver-builder')\r\n  const [value = initialValue, setValue] = useState()\r\n  const [saved = initialValue, setSaved] = useState()\r\n  \r\n  const save = data => isPopup ? setValue(data) : (setSaved(data), setValue(data))\r\n\r\n  useEffect(() => props.save(saved), [saved])\r\n  useEffect(() => { isPopup && isOpen ? setValue(saved) : null }, [isOpen])\r\n\r\n  /**\r\n   * Needed to remove class we add on body when popup open (beaver-builder fix to handle conflict with select2)\r\n   */\r\n  useEffect(() => {\r\n    if( ! isOpen && props.onPopupClose ) props.onPopupClose()  \r\n  }, [isOpen])\r\n\r\n  const labelStyle = { display: 'flex', marginBottom: '10px' }\r\n\r\n  const control =\r\n    <>\r\n      { builder === 'elementor' && !isPopup ?\r\n        <label className={ 'elementor-control-title' } style={ labelStyle }>\r\n          { field.label }\r\n        </label> : '' }\r\n\r\n      <div className={ `tangible-block-control tangible-block-control-${config.type}` }>\r\n        { getLegacyControl(config, save, saved, field) }\r\n      </div>\r\n    </>\r\n  \r\n  if( !isPopup ) return control;\r\n\r\n  const cancel = () => setIsOpen(false)\r\n  const submit = () => { setIsOpen(false), setSaved(value) }\r\n  \r\n  /**\r\n   * The button/onClick logic is not handled here in the case of beaver-builder because we need to create \r\n   * the button and the popup at 2 different places in the DOM\r\n   * \r\n   * @see assets/src/beaver-template-editor/fields/dynamic/index.js\r\n   */\r\n\r\n  const button = builder !== 'beaver-builder'\r\n    ? <div className={ `tangible-control-modal-button-container tangible-control-modal-button-container-${builder}` }>\r\n\r\n        { builder === 'elementor' ? <label className='elementor-control-title' style={ labelStyle } >{ field.label }</label> : '' }\r\n      \r\n        <button onClick={ () => setIsOpen(!isOpen) } className='components-button is-secondary tangible-control-btn'>\r\n          Open Settings\r\n        </button>\r\n      </div>\r\n    : ''\r\n\r\n  if(!isOpen) return button;\r\n\r\n  return(\r\n    <>\r\n      { button }\r\n      <Modal submit={ submit } cancel={ cancel } title={ field.label }>\r\n        { control }\r\n      </Modal>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default LegacyControl\r\n","import {\r\n  render, \r\n  unmountComponentAtNode\r\n} from 'react'\r\n\r\nimport LegacyControl from '../../template-block-fields/legacy-fields/LegacyControl'\r\n\r\n/**\r\n * Init custom legacy controls\r\n * \r\n * @see tangible-block-fields/Control.js  \r\n */\r\n\r\nconst initLegacyControl = control => {\r\n\r\n  const elementorControl = elementor.modules.controls.BaseData.extend({\r\n\r\n    onReady: function() {\r\n\r\n      const wrapper = this.ui.contentEditable.prevObject[0]\r\n      const reactDiv = wrapper.getElementsByClassName(control.prefixed_type)[0]\r\n\r\n      const field = JSON.parse(reactDiv.getAttribute('data-field'))\r\n\r\n      const saveValue = this.saveValue.bind(this)\r\n\r\n      render(<LegacyControl \r\n        config={ control }\r\n        field={ field }\r\n        initialValue={ this.ui.input.val() }\r\n        builder={ 'elementor' }\r\n        save={ saveValue } \r\n      />, reactDiv)\r\n    },\r\n\r\n    saveValue: function(value) {\r\n      this.ui.input.val(value)\r\n      this.setValue(this.ui.input.val()) \r\n    },\r\n\r\n    /**\r\n     * Called automatically by elementor\r\n     */\r\n    onBeforeDestroy: function() {\r\n\r\n      this.saveValue(this.ui.input.val())\r\n\r\n      const wrapper = this.ui.contentEditable.prevObject[0]\r\n      unmountComponentAtNode(wrapper)\r\n    }\r\n  })\r\n\r\n  elementor.addControlView(control.prefixed_type, elementorControl)\r\n}\r\n\r\nexport {\r\n  initLegacyControl\r\n}\r\n","import {\r\n  render, \r\n  unmountComponentAtNode\r\n} from 'react'\r\n\r\nimport Control from '../../template-block-fields/Control'\r\nimport { initLegacyControl } from './legacy'\r\n\r\nconst $ = jQuery\r\nconst { \r\n  blockConfig: { \r\n    controls,\r\n    legacy_controls \r\n  } \r\n} = Tangible\r\n\r\n$(window).on('elementor:init', () => {\r\n  \r\n  for( const controlName in controls ) {\r\n    initControl(controls[controlName])\r\n  }\r\n  \r\n  for( const controlName in legacy_controls ) {\r\n    initLegacyControl(legacy_controls[controlName])\r\n  }\r\n\r\n})\r\n\r\n/**\r\n * Init custom controls\r\n * \r\n * @see tangible-block-fields/Control.js  \r\n */\r\n\r\nconst initControl = control => {\r\n\r\n  const elementorControl = elementor.modules.controls.BaseData.extend({\r\n\r\n    onReady: function() {\r\n\r\n      const wrapper = this.ui.contentEditable.prevObject[0]\r\n      const reactDiv = wrapper.getElementsByClassName(control.prefixed_type)[0]\r\n\r\n      const field = JSON.parse(reactDiv.getAttribute('data-field'))\r\n\r\n      const saveValue = this.saveValue.bind(this)\r\n\r\n      render(<Control \r\n        config={ control }\r\n        field={ field }\r\n        initialValue={ this.ui.input.val() }\r\n        builder={ 'elementor' }\r\n        save={ saveValue } \r\n      />, reactDiv)\r\n    },\r\n\r\n    saveValue: function(value) {\r\n      this.ui.input.val(value)\r\n      this.setValue(this.ui.input.val()) \r\n    },\r\n\r\n    /**\r\n     * Called automatically by elementor\r\n     */\r\n    onBeforeDestroy: function() {\r\n\r\n      this.saveValue(this.ui.input.val())\r\n\r\n      const wrapper = this.ui.contentEditable.prevObject[0]\r\n      unmountComponentAtNode(wrapper)\r\n    }\r\n  })\r\n\r\n  elementor.addControlView(control.prefixed_type, elementorControl)\r\n}\r\n"],"names":["_ControlVisibility","_a","conditionsMap","conditions","getFieldValue","visibility","key","condition","indexes","number","level","conditionNumber","conditionLevel","currentLevel","previousConditions","rules","comparisons","field","_","index","previousCondition","value","compare","fieldValue","firstValue","secondValue","operator","result","__name","ControlVisibility","$","setVisibility","$container","repeater","items","$items","item","i","$item","values","controls","getValue","name","$control","isVisible","refresh","observer","mutations","init","clear","maybeInitTabsWorkaround","tabs","firstTab","Tangible","prefix","tabsByBlock","sectionsByBlock","widgetVisibility","currentWidget","widgdetName","blockId","getBlockControls","sections","getElementorSettings","widgetName","tangibleControls","controlName","element","elementorSettings","controlSettings","getControlSettings","tabName","tab","$tab","sectionName","section","$section","control","repeaterConditions","settings","setting","$switch","panel","model","Modal","props","getControl","handler","builder","O","e","o","n","M","a","t","m","c","l","useState","useEffect","s","wp","Text","setValue","h","p","r","u","useRef","f","g","Order","getData","setData","includeOrder","includeOrderBy","order","Select","orderBy","orderByField","orderByFieldNumber","Type","initialLoopType","initialType","fields","loopType","setLoopType","type","setType","contentType","contentFields","allTaxonomies","QueryGroup","initialData","save","showBtn","remove","isFirst","taxonomies","params","setParams","getTerms","selectedTaxonomy","terms","options","term","getParam","x","updateTerms","setTermOptions","oldTerms","updateParam","oldParams","termOptions","option","tax","newTerms","selectedValues","selection","MAXQUERYNUMBER","Taxonomy","rows","setRows","relation","setRelation","data","initialRows","suffix","savedData","taxonomyRelation","addRow","saveRow","removeRow","allPostTypes","PostQuery","fieldList","parseData","json","args","setArgs","updateArgs","oldArgs","taxonomy","newParams","val","ajax","AjaxSelect","initialValue","search","setSearch","setOptions","isOpen","setIsOpen","className","isMultiple","results","errors","saveValue","removeValue","currentValue","crossIcon","getLegacyControl","selectValue","LegacyControl","config","isPopup","saved","setSaved","labelStyle","cancel","submit","button","render","unmountComponentAtNode","wrapper","v","d"],"mappings":"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"}